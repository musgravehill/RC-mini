function _ga(){try{ga.apply(this,Array.prototype.slice.call(arguments))}catch(a){console.log(a)}}
function initSocialAuthDialog(){var a={};a[gettext("\u0412\u043e\u0439\u0442\u0438")]=doSocialAuth;makeDialog("#social_auth_dialog",{width:500,height:200,buttons:a},{addClose:true,setGray:true});$("#social_user_info").keyup(function(){var b=trim($(this).val());setDialogButtonState("social_auth_dialog",gettext("\u0412\u043e\u0439\u0442\u0438"),b.length>0);return false});$("#social_auth_form").submit(function(b){b.preventDefault();getDialogButtonState("social_auth_dialog",gettext("\u0412\u043e\u0439\u0442\u0438"))&&
doSocialAuth()});$(".login_lj_link").click(function(){return showSocialAuthDialog("lj")});$(".login_ya_link").click(function(){return showSocialAuthDialog("ya")});$(".login_oid_link").click(function(){return showSocialAuthDialog("oid")});$(".login_gl_link").click(function(){return showSocialAuthDialog("gl")});$(".login_fb_link").click(function(){return showSocialAuthDialog("fb")});$(".login_tw_link").click(function(){return showSocialAuthDialog("tw")});$(".login_vk_link").click(function(){showSocialAuthDialog("vk")});
$(".login_odnokl_link").click(function(){return showSocialAuthDialog("odnokl")});$(".login_mr_link").click(function(){return showSocialAuthDialog("mr")})}
function setupSocialAuthDialog(a){var b,d=gettext("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"),e="",f,c={show:true,wait:true};switch(a){case "gl":f="/login/google-oauth2";c.show=false;c.wait=false;break;case "fb":f="/login/facebook";c.show=false;c.wait=false;break;case "tw":f="/login/twitter";c.show=false;c.wait=false;break;case "vk":f="/login/vkontakte-oauth2";c.show=false;c.wait=false;break;case "odnokl":f=
"/login/odnoklassniki";c.show=false;c.wait=false;break;case "mr":f="/login/mailru-oauth2";c.show=false;c.wait=false;break;case "lj":b=gettext("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u0432 LiveJournal");e="openid_lj_user";f="/login/livejournal";break;case "ya":f="/login/yandex-oauth2/";c.show=false;c.wait=false;break;case "oid":b=gettext("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 OpenID");
d=gettext("URL \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438");e="openid_identifier";f="/login/openid"}if(c.show){$("#social_auth_dialog").dialog("option","title",b);$("#social_user_info_label").text(d);$("#social_user_info").attr("name",e);$("#social_user_info").val("")}$("#social_auth_form").attr("action",f);return c}
function showSocialAuthDialog(a){a=setupSocialAuthDialog(a);$("#login_dialog").dialog("isOpen")&&$("#login_dialog").dialog("close");if(a.show){$("#social_auth_dialog").dialog("open");setDialogButtonState("social_auth_dialog",gettext("\u0412\u043e\u0439\u0442\u0438"),false);toggleDialogButton("social_auth_dialog",gettext("\u0412\u043e\u0439\u0442\u0438"),true);$("#social_auth_form").show();$("#social_auth_form_progress").html("")}a.wait||doSocialAuth();return false}
function doSocialAuth(){$("#social_auth_form").hide();setWaitingDiv("#social_auth_form_progress");toggleDialogButton("social_auth_dialog",gettext("\u0412\u043e\u0439\u0442\u0438"),false);var a=$("#social_auth_form").attr("action");if(a){a+="?";var b=$("#social_user_info").attr("name");if(b){b+="="+encodeURI($("#social_user_info").val());a+=b+"&"}b=$login_dialog.find('input[name="next"]');if(b.val()=="/accounts/")if(window.location.hash!=""||window.location.pathname!="/")b.val(window.location.pathname+
window.location.hash);a+="next="+encodeURIComponent("/socialauth/login_close");makePopupWindow(a,gettext("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f"))}}
function showLoginDialogCart(a){$.get("/"+language+"/accounts/ajax/register/",function(b){b=="authorized"?window.location.reload(true):makeRegFormForCart(b,true)});(function(){$(".postage #login_dialog_cart").hide();$("#cart-form").submit(function(){return false});$login_dialog_cart.show().animate({opacity:1},400);$("html, body").animate({scrollTop:$login_dialog_cart.offset().top-50},1E3)})();$login_dialog_cart.find("#login-btn").click(login);if(a)a.error?$login_dialog_cart.find("#name_error").show():
$login_dialog_cart.find("#name_error").hide()}
function makeRegFormForCart(a,b){b?_ga("send","event","regFormInCart","open","registration"):_ga("send","event","regFormInCart","error","registration");var d=$("<button/>").css({margin:"10px 10px 0 166px"}).attr({id:"reg-btn",type:"button",role:"button","aria-disabled":"false"}).addClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only").append($("<span/>").addClass("ui-button-text").text(gettext("\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c"))).append($("<div/>").attr("id","regform_progress").css("display",
"inline-block"));$login_dialog_cart.find("#login-reg-content").html(a);$login_dialog_cart.find("#registration_block").append('<input type="hidden" name="next" value="/#popupopen=Cart">').append(d);$("#register_form_block input[placeholder]").placeholder();$("#register_form_block form").submit(function(){return false});language=="ru"?$.getScript("http://api-maps.yandex.ru/2.0-stable/?load=package.search,package.map&lang="+language+"&ns=Park_reg&onload=run_check_reg_cart"):d.click(submitRegFormInCart);
bindEvent($(".control-group input"),"keyup",function(e){$("#"+e.target.id).parents(".control-group").removeClass("error").find("span").remove()})}
function submitRegFormInCart(){_ga("send","event","regFormInCart","submit","registration");var a=$("#registration_block");a.find("#id_city_show");create_reghash(a[0]);setWaitingDiv("#regform_progress");$.post("/"+language+"/accounts/ajax/register/",a.serialize(),function(b){$("#regform_progress").html("");if(b=="ok")window.location="/#popupopen=Cart";else makeRegFormForCart(b,false)})}
function showLoginDialog(a){var b=$login_dialog.find('input[name="next"]');if(a){a.error?$("#name_error").show():$("#name_error").hide();a.title?$login_dialog.dialog("option","title",a.title):$login_dialog.dialog("option","title",$login_dialog.data("default_title"));if(a.redirect_to)b.val(a.redirect_to);else window.location.hash||window.location.pathname!="/"||window.location.search?b.val(encodeURI(window.location.href)):b.val("/accounts/")}$login_dialog.dialog("isOpen")||$login_dialog.dialog("open");
return false}function bindCurrencyByCountry(){$("input#id_city_show").bind("change.check_city",function(){var a=$(this).data("country");$("#id_currency").prop("disabled",false);a=="RU"&&$("#id_currency").val("RUR").prop("disabled",true)})}
function run_check_reg_cart(){window.check=$("input#id_city_show").check_city({log:true,id_autocmplt:"input#id_city_show",id_form:"#registration_block",submit_form:submitRegFormInCart,id_btn:"#reg-btn",show_all_countries:language=="en",reg:true,tags:"",yandex_API:Park_reg});bindCurrencyByCountry()}
function run_check_reg(){window.check=$("input#id_city_show").check_city({log:true,id_autocmplt:"input#id_city_show",id_form:"#registration_block",submit_form:submitRegForm,id_btn:"#reg_btn_submit",show_all_countries:language=="en",reg:true,tags:"",yandex_API:Park_reg});bindCurrencyByCountry()}
function getRegForm(a){_ga("send","event","regForm","open","registration");$("#success_registration").hide();if($("#registration_block_wrap").length){a&&a();$regdialog.dialog("open")}else{$.get("/"+language+"/accounts/ajax/register/",function(b){if(b=="authorized")window.location.reload(true);else{$("#register_form_block").html(b);$("#register_form_block .acc_link").click(function(){_ga("send","event","regForm","socialAuth","registration")});a&&a();$regdialog.dialog("open");$("#register_form_block input[placeholder]").placeholder();
$("#register_form_block form").submit(function(){return false});language=="ru"&&$.getScript("http://api-maps.yandex.ru/2.0-stable/?load=package.search,package.map&lang="+language+"&ns=Park_reg&onload=run_check_reg")}});return false}}
function login(){var a=$("#login_form"),b=$("#login-btn",a);if(b.hasClass("disabled"))return false;b.addClass("disabled");setWaitingDiv("#login_progress");$.post("/"+language+"/accounts/ajax/login/",a.serialize(),function(d){$("#login_progress").html("");if(d.status=="ok"){d.redirect_to&&auth_redirect(d.redirect_to);if(d.html)document.documentElement.innerHTML=d.html}else{b.removeClass("disabled");$('input[type="password"]',a).placeholder();showLoginDialog({error:true})}},"json");return false}
function auth_redirect(a){if(a==undefined)a=$login_dialog.find('input[name="next"]').val();if(/\/#\w+/.test(a))window.location.reload(true);else window.location=a}function create_reghash(a){var b=$("#id_sur_name",a).length?$("#id_sur_name",a).val():"";b=$("#id_first_name",a).val()+$("#id_last_name",a).val()+b;b=$.md5(b);b=$("<input />").attr({name:"reghash",type:"hidden"}).val(b);$(a).append(b)}
function submitRegForm(){_ga("send","event","regForm","submit","registration");$reg_form_block=$("#register_form_block");create_reghash($("#registration_block")[0]);setWaitingDiv("#regform_progress");$.post("/"+language+"/accounts/ajax/register/",$("#registration_block").serialize(),function(a){$("#regform_progress").html("");if(a=="ok"){_ga("send","event","regForm","success","registration");$reg_form_block.hide();$("#success_registration").show();makeDialog("#register_dialog",null,{addClose:true,
update:true});window.location="/"+language+"/accounts/registerc/complete/"}else{_ga("send","event","regForm","error","registration");$reg_form_block.html(a);language=="ru"&&run_check_reg();$("input[placeholder]",$reg_form_block).placeholder();$("form",$reg_form_block).submit(function(){return false});$(".error input, .alert-error input",$reg_form_block).first().focus()}$regdialog.dialog("open")})}
function bindEvent(a,b,d){for(var e=0;e<a.length;e++)a[e].addEventListener?a[e].addEventListener(b,d,true):a[e].attachEvent("on"+b,d)}var $login_dialog,$regdialog,$login_dialog_cart;
jQuery(document).ready(function(){$login_dialog=makeDialog("#login_dialog",{width:645,height:"auto"});is_auth||$(".checkout-btn").unbind("click").click(function(b){b.preventDefault();$login_dialog_cart=$(b.target).parents(".postage").find("#login_dialog_cart");showLoginDialogCart({error:false});return false});var a=$login_dialog.find("#reg-btn");$login_dialog.find("#login-btn");a.click(function(){setWaitingDiv("#reg_progress");getRegForm(function(){$login_dialog.dialog("close");$("#reg_progress").html("");
initSocialAuthDialog()})});$("#login_form").submit(login);initSocialAuthDialog();$(".register_link").click(function(){getRegForm(initSocialAuthDialog)});$(".login_link").click(showLoginDialog);$login_dialog.data("default_title",$("#ui-dialog-title-login_dialog").html());a={};a[gettext("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f")]={text:gettext("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"),
click:submitRegForm,id:"reg_btn_submit"};$regdialog=makeDialog("#register_dialog",{width:485,height:"auto",buttons:a,close:function(){$("#register_form_block").show();$("#success_registration").hide();$("#regform_progress").html("")}});$regdialog.parent().keypress(function(b){if(b.which&&b.which==13||b.keyCode&&b.keyCode==13){$("#reg_btn_submit",this).click();return false}}).find("#reg_btn_submit").append('&nbsp;<div id="regform_progress" style="display: inline-block;"></div>');if(popupopen=$.hashdata.get("popupopen")){a=
$.hashdata.get("next")||"";switch(popupopen){case "popupLogin":showLoginDialog({redirect_to:a});break;case "popupReg":getRegForm(initSocialAuthDialog)}}$.md5||$.getScript("/static/js/jquery.md5.js");bindEvent($(".control-group input"),"keyup",function(b){$(b.target).parents(".control-group").removeClass("error").find("span").remove()});navigator.userAgent.toLowerCase().indexOf("android")>-1&&$(".control-group input").keyup(function(b){$(b.target).parents(".control-group").removeClass("error").find("span").remove()})});
